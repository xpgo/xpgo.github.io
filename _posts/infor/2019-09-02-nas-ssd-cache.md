---
layout: post
title: 群晖NAS开启SSD缓存后的体验
subtitle: 在群晖NAS中开启SSD缓存有什么好处，是否值得？
author: xpgo
category: Infor
tags: [blog, nas]
---

![NAS with SSD Cache](https://static.chiphell.com/forum/201801/29/174021brqqm2sx61r4nsxy.jpg)

我的群晖NAS型号是DS1517+，属于高性能机型，硬件和软件可扩展性都比较强，硬件方面可以通过M2D17或M2D18的卡及两块SSD固态实现SSD缓存功能。软件方面，我在在NAS上安装了Docker，部署了很多网站服务，除了NAS本身自带的文件和照片访问服务外，还通过Docker部署了10+个容器，因此NAS的随机读写量比较大。

之前在网上了解过，开启SSD缓存之后，可以有效提升NAS的访问速率。但这不是让我心动的主要原因，因为家里的带宽是100M的，瓶颈在于网络服务出口，而不在于硬盘的读写速度。让我决定尝试一下是因为噪声。没办法，房子小，NAS的位置离卧室比较近，由于NAS的随机读写量大，时不时的就听见机械硬盘有咯咯的响声，那些硬盘的灯一直在闪，说明硬盘一直在寻址进行读写操作。对于部署的网络服务较多时，硬盘在那里没日没夜的响，虽然没有到严重影响睡眠的程度，但有时还时会让人不清静。

在了解了SSD缓存原理之后，心想如果开启SSD缓存，大多数重复的数据会通过SSD读取，可以有效减少机械硬盘的访问量，从而减少噪音。因此，狠心花了些钱开启了SSD缓存配置，我的配置是：

- NAS是群晖DS1517+，有5个盘位，目前用了3个盘位，各插了一个7.5T的HDD硬盘，做了RAID5后空间有14T多，内存是8G。
- M2D18扩展卡，在群晖官网买的，它支持NVE和SATA的SSD，但DS1517+只能用SATA的SSD。
- 2块三星860EVO，M.2 SATA的固态硬盘，单个容量是250G。

## SSD缓存的安装和配置

安装起来很简单，具体可参考文章[群晖 DS1517+ 升级改造](https://www.chiphell.com/thread-1915709-1-1.html)和[群晖DS1517+视频工作室集中存储方案搭建手记](https://www.chiphell.com/thread-1821849-1-1.html)。M2D18的卡还带SSD的散热贴片，安装散热贴片时，建议把三星SSD的标签去掉，便于散热。

![M2D18](https://static.chiphell.com/forum/201810/06/172541ik7eeorkegl5vlzp.jpg)

硬件安装完之后，在NAS的存储空间管理员中就可以新建SSD缓存了，有两种模式，一是只读缓存，另一种是读写缓存。读写缓存需要有2个SSD组成RAID1，据说当读写缓存模式下SSD缓存写满之后，容易出现NAS死机需要定期重启的情况，我安装完之后，目前还没有达到写满的状态，所以还没有遇到这种情况。

![Setup SSD Cache](https://static.chiphell.com/forum/201801/29/175337e5qnaynx5en2yyy2.jpg)

新建之后，大概花了20分钟完成了缓存的初始化，后面SSD缓存的使用量会逐渐上升，第一天的时候上升的比较快，之后会随着NAS的使用缓慢增加。

## 启用SSD缓存之后

### 终于清静了

安装SSD缓存之后最让我满意的是，机械硬盘的访问量降低了很多，很少听见咯咯的声响了，硬盘的灯也不再频繁闪烁了。这是因为很多网络服务的常用文件都被自动放到SSD缓存上了，几天下来缓存命中率高达99%，可以说利用率非常高，很值。

![SSD Cache hit rate](https://ngrok.xscale.cn:8097/images/2019/09/04/f75781803453869bb4348b720fd44f9f.jpg)

### HDD访问频率明显降低

从存储空间的利用率可以看到，安装了SSD缓存之后，利用率明显降低了，整体的读传输速率提高了近3倍，写的传输速率提高了近1倍，当然这些改进对于网络服务而言没有明显的感觉，主要会对机械硬盘的寿命有所提升，当然是这是牺牲SSD的所花的钱得来的。

![SSD Cache HDD usage](https://ngrok.xscale.cn:8097/images/2019/09/04/eb26b24b4485de60b286e07eb473bbb4.jpg)

## 值不值得升级SSD缓存？

如果你在犹豫要不要花钱整一个SSD缓存，要具体看你想得到什么样的效果，如果是想降低噪声的话，我觉得应该可以达到满意的效果。如果是想单纯的提高读写性能，也会有效果，特别是对于NAS上部署了很网络服务的情况，SSD的缓存命中率可以很高。但如果你用NAS主要是看电影和下电影，改善的效果可能有限。





